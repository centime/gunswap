!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){b.exports.interpolateBezierSpline=function(a,b,c,d,e,f){var g;if(0==b)g=a[0];else if(1==b)g=a.last();else{1==a.length&&a.push(a[0]);for(var h=[{x:a[0].x+c.dx*e,y:a[0].y+c.dy*e,z:a[0].z+c.dz*e},{x:a.last().x-d.dx*f,y:a.last().y-d.dy*f,z:a.last().z-d.dz*f}],i=1e-5,j=[],k=[],l=0;l<a.length-1;l++){var m,n,o=a[l],p=a[l+1];if(0==l)m=h[0];else{var q=j[j.length-1],m={x:o.x+(o.x-q.x),y:o.y+(o.y-q.y),z:o.z+(o.z-q.z)};j.push(m)}if(l+1==a.length-1)n=h[1];else{var r={x:(a[l].x+a[l+1].x)/2,y:(a[l].y+a[l+1].y)/2,z:(a[l].z+a[l+1].z)/2},s={x:(a[l+1].x+a[l+2].x)/2,y:(a[l+1].y+a[l+2].y)/2,z:(a[l+1].z+a[l+2].z)/2},t=Math.sqrt(Math.pow(a[l].x-a[l+1].x,2)+Math.pow(a[l].y-a[l+1].y,2)+Math.pow(a[l].z-a[l+1].z,2)),u=Math.sqrt(Math.pow(a[l+1].x-a[l+2].x,2)+Math.pow(a[l+1].y-a[l+2].y,2)+Math.pow(a[l+1].z-a[l+2].z,2)),v=t/(t+u),w={x:(1-v)*r.x+v*s.x,y:(1-v)*r.y+v*s.y,z:(1-v)*r.z+v*s.z};n={x:p.x+(r.x-w.x),y:p.y+(r.y-w.y),z:p.z+(r.z-w.z)},j.push(n)}for(var v=0;1+i>=v;v+=.02)k.push({x:Math.pow(1-v,3)*o.x+3*Math.pow(1-v,2)*v*m.x+3*(1-v)*Math.pow(v,2)*n.x+Math.pow(v,3)*p.x,y:Math.pow(1-v,3)*o.y+3*Math.pow(1-v,2)*v*m.y+3*(1-v)*Math.pow(v,2)*n.y+Math.pow(v,3)*p.y,z:Math.pow(1-v,3)*o.z+3*Math.pow(1-v,2)*v*m.z+3*(1-v)*Math.pow(v,2)*n.z+Math.pow(v,3)*p.z}),k.last().dist=1==k.length?0:k[k.length-2].dist+Math.sqrt(Math.pow(k.last().x-k[k.length-2].x,2)+Math.pow(k.last().y-k[k.length-2].y,2)+Math.pow(k.last().z-k[k.length-2].z,2))}var x;if(siteswap.matchVelocity){var y=Math.sqrt(Math.pow(c.dx,2)+Math.pow(c.dy,2)+Math.pow(c.dz,2)),z=Math.sqrt(Math.pow(d.dx,2)+Math.pow(d.dy,2)+Math.pow(d.dz,2)),A=k.last().dist,B=siteswap.dwellDuration,C=(6*B*(z+y)-12*A)/Math.pow(B,3),D=(z-y-.5*C*Math.pow(B,2))/B,E=b*B,F=y*E+.5*D*Math.pow(E,2)+1/6*C*Math.pow(E,3);x=0;for(var l=0;l<k.length;l++)k[l].dist<=F&&(x=l)}else x=Math.floor(b*k.length);g=k[0>x?0:x]}return g}},{}],2:[function(a,b){function c(a,b){if(this.gaConfig=a,this.fitnessConfig=b,void 0===b.axis1)for(var c=0;c<this.fitnessConfig.surfaces.length;c++){var e=this.fitnessConfig.surfaces[c];d.normalize(e.normal);var f;f=0==e.normal.x&&0==e.normal.z?{x:1,y:0,z:0}:{x:-e.normal.z,y:0,z:e.normal.x};var g=d.cross(e.normal,f);d.normalize(f),d.normalize(g),d.multiply(f,e.scale),d.multiply(g,e.scale),e.axis1=f,e.axis2=g}this.generations=0,this.rankedPopulation=[],this.fittestMembers=[],this.ableToFindSolution=void 0}var d=a("./util.js");c.prototype.getBouncePath=function(a){var b=cloneObject(this.fitnessConfig.p0),c=cloneObject(a),e=[],f=[];e.push(cloneObject(b)),f.push(cloneObject(c));for(var g=0;g<this.fitnessConfig.surfaces.length;g++)this.fitnessConfig.surfaces[g].bounces=0,this.fitnessConfig.surfaces[g].colliding=!1;for(var h=0,i=[],j=[],k=0;k<=this.fitnessConfig.maxT;k+=this.fitnessConfig.dt){d.add(b,d.multiply(cloneObject(c),this.fitnessConfig.dt)),c.y+=this.fitnessConfig.G*this.fitnessConfig.dt,e.push(cloneObject(b)),f.push(cloneObject(c));for(var g=0;g<this.fitnessConfig.surfaces.length;g++){var l=this.fitnessConfig.surfaces[g],m=l.normal.x*b.x+l.normal.y*b.y+l.normal.z*b.z-l.normal.x*l.position.x-l.normal.y*l.position.y-l.normal.z*l.position.z;if(Math.abs(m)<=this.fitnessConfig.R&&Math.abs(d.dot(d.sub(cloneObject(b),l.position),d.normalize(cloneObject(l.axis1))))<=l.scale&&Math.abs(d.dot(d.sub(cloneObject(b),l.position),d.normalize(cloneObject(l.axis2))))<=l.scale&&!l.colliding){l.colliding=!0,l.bounces++,i.push(g),h++;var n=(new THREE.Vector3).copy(l.normal),n=cloneObject(l.normal);d.multiply(n,d.dot(c,l.normal)),d.multiply(n,2*this.fitnessConfig.C),d.negate(n),d.add(c,n)}else Math.abs(m)>this.fitnessConfig.R&&l.colliding&&(l.colliding=!1)}if(k>=this.fitnessConfig.minT||k+this.fitnessConfig.dt>this.fitnessConfig.maxT){var o=!0;this.fitnessConfig.surfaceBounceOrder&&i.toString()!=this.fitnessConfig.surfaceBounceOrder.toString()&&(o=!1);var p=!1;h==this.fitnessConfig.numBounces&&(p=!0),o&&p&&(1==this.fitnessConfig.catchSign&&c.y>=0||-1==this.fitnessConfig.catchSign&&c.y<=0||void 0==this.fitnessConfig.catchSign)&&(1==this.fitnessConfig.tossSign&&a.y>=0||-1==this.fitnessConfig.tossSign&&a.y<=0||void 0==this.fitnessConfig.tossSign)&&j.push({pT:cloneObject(b),T:k,actualpT:this.fitnessConfig.pT})}}return j.length>0?(j.sort(function(a,b){return d.magnitude(d.sub(cloneObject(a.pT),a.actualpT))-d.magnitude(d.sub(cloneObject(b.pT),a.actualpT))}),{path:e.splice(0,j[0].T/this.fitnessConfig.dt),velocities:f.splice(0,j[0].T/this.fitnessConfig.dt),T:j[0].T}):{path:void 0,velocities:void 0,T:void 0}},c.prototype.generateMember=function(a){var b={x:0,y:0,z:0};if(a&&a.fitness<100)Math.random()<this.gaConfig.mutationChance?(b.x=(1-2*Math.random())*(a.fitness<this.gaConfig.mutationScale?a.fitness:this.gaConfig.mutationScale),b.y=(1-2*Math.random())*(a.fitness<this.gaConfig.mutationScale?a.fitness:this.gaConfig.mutationScale),b.z=(1-2*Math.random())*(a.fitness<this.gaConfig.mutationScale?a.fitness:this.gaConfig.mutationScale),d.add(b,a.v)):b=cloneObject(a.v);else{var c;c=this.fitnessConfig.surfaceBounceOrder?this.fitnessConfig.surfaces[this.fitnessConfig.surfaceBounceOrder[0]]:this.fitnessConfig.surfaces[Math.floor(Math.random()*this.fitnessConfig.surfaces.length)],b=cloneObject(c.position),d.add(b,d.multiply(cloneObject(c.axis1),1-2*Math.random())),d.add(b,d.multiply(cloneObject(c.axis2),1-2*Math.random()));var e=b.y;b.y=0;var f=cloneObject(this.fitnessConfig.p0);f.y=0;var g=cloneObject(this.fitnessConfig.pT);g.y=0;var h=0,i=this.gaConfig.initialScale;d.sub(b,f),d.normalize(b),d.multiply(b,h+(i-h)*Math.random()),h=1==this.fitnessConfig.tossSign||e>this.fitnessConfig.p0.y?0:-(2*(this.fitnessConfig.p0.y-e)/this.fitnessConfig.minT),i=this.gaConfig.initialScale,b.y=h+(i-h)*Math.random()}var j=this.getBouncePath(b);return{v:b,T:j.T,fitness:j.path?d.magnitude(d.sub(cloneObject(j.path[j.path.length-1]),this.fitnessConfig.pT)):100}},c.prototype.evolve=function(){if(this.generations>=this.gaConfig.maxGenerations)this.ableToFindSolution=!1;else if(this.rankedPopulation.length>0&&this.rankedPopulation[0].fitness<=this.gaConfig.fitnessThreshold)this.ableToFindSolution=!0;else{if(0==this.rankedPopulation.length||this.gaConfig.noGA){this.rankedPopulation=[];for(var a=0;a<this.gaConfig.populationSize;a++)this.rankedPopulation.push(this.generateMember(void 0))}else{for(var b=0,c=[],a=0;a<this.rankedPopulation.length;a++)b+=1/this.rankedPopulation[a].fitness,c.push(b);for(var d=[],a=0;a<this.gaConfig.populationSize;a++)if(a<.5*this.gaConfig.populationSize)d.push(this.generateMember(void 0));else for(var e=Math.random()*b,f=0;f<c.length;f++)if(e<c[f]){d.push(this.generateMember(this.rankedPopulation[f]));break}this.rankedPopulation=d}this.rankedPopulation.sort(function(a,b){return a.fitness-b.fitness});var g=this.rankedPopulation[0];this.fittestMembers.push(g),this.generations++,this.generations%100==0&&console.log(this.generations+" "+g.fitness),this.evolve()}},b.exports.BounceGA=c},{"./util.js":7}],3:[function(a,b){function c(a){for(var b=0,c=0;c<a.length;c++)parseInt(a[c])?b+=parseInt(a[c]):a.charCodeAt(c)>=97&&a.charCodeAt(c)<=119&&(b+=a.charCodeAt(c)-87),"P"!=a[c]&&"S"!=a[c]||!parseInt(a[c+1])||c++,"B"!=a[c]&&"D"!=a[c]&&"T"!=a[c]&&"C"!=a[c]&&"S"!=a[c]||"{"!=a[c+1]||(c=a.indexOf("}",c));return b}function d(a,b){function d(){if(void 0===b&&(b={}),A.validationOnly=void 0===b.validationOnly?!1:b.validationOnly,A.beatDuration=void 0===b.beatDuration?.2:b.beatDuration,A.dwellDuration=void 0===b.dwellRatio?.5*A.beatDuration:A.beatDuration*b.dwellRatio,A.numStepsPerBeat=void 0===b.numStepsPerBeat?Math.floor(200*A.beatDuration):b.numStepsPerBeat,A.matchVelocity=void 0===b.matchVelocity?!1:b.matchVelocity,A.dwellCatchScale=void 0===b.dwellCatchScale?.05:b.dwellCatchScale,A.dwellTossScale=void 0===b.dwellTossScale?.05:b.dwellTossScale,A.emptyTossScale=void 0===b.emptyTossScale?.05:b.emptyTossScale,A.emptyCatchScale=void 0===b.emptyCatchScale?.05:b.emptyCatchScale,A.armAngle=void 0===b.armAngle?.1:b.armAngle,A.props=void 0===b.props?[{type:"ball",radius:.05,C:.95}]:b.props,A.dwellPath=void 0===b.dwellPath?[[{x:.3,y:0,z:0,rotation:{x:4,y:0,z:-1,th:Math.PI/2}},{x:.1,y:0,z:0,rotation:{x:4,y:0,z:1,th:Math.PI/2}}]]:b.dwellPath,A.surfaces=void 0===b.surfaces?[{position:{x:0,y:0,z:0},normal:{x:0,y:1,z:0},scale:5}]:b.surfaces,A.jugglers=[],void 0===b.jugglers||A.numJugglers!=b.jugglers.length)for(var a=0;a<A.numJugglers;a++)A.jugglers.push({position:{x:0,z:-2*a},rotation:a*Math.PI});else for(var a=0;a<b.jugglers.length;a++)A.jugglers.push({position:b.jugglers[a].position,rotation:b.jugglers[a].rotation});for(var a=0;a<A.surfaces.length;a++){var c=A.surfaces[a];g.normalize(c.normal);var d;d=0==c.normal.x&&0==c.normal.z?{x:1,y:0,z:0}:{x:-c.normal.z,y:0,z:c.normal.x};var e=g.cross(c.normal,d);g.normalize(d),g.multiply(d,c.scale),g.normalize(e),g.multiply(e,c.scale),c.axis1=d,c.axis2=e}}function l(){var b=1,c=/<[^ ]+>/.test(a);if(c){var d=a.match(/<[^ <>]+>/g);if(b=d[0].split("|").length,1==b)return A;var e=b;d.map(function(a){return a.split("|").length!=e?A:void 0})}var f="";2==b?f="P":b>2&&(f="P[1-"+b+"]");var g="(R|L)?([\\da-o])x?A?("+f+")?(C{(C|P)?})?(T{(C|P)?})?(B({\\d*(L|HL|F|HF)?})?)?(S{-?\\d+(.\\d+)?(,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?,-?\\d+(.\\d+)?)?})?(D{\\d*\\.?\\d*})?",h="\\[("+g+")+\\]",i="\\(("+g+"|"+h+"),("+g+"|"+h+")\\)",j="("+g+"|"+h+"|"+i+")",k="<"+j+"(\\|"+j+")+>",l="^("+k+")+|("+j+")+$";u=new RegExp(g,"g"),v=new RegExp(h,"g"),w=new RegExp(i,"g"),x=new RegExp(j,"g"),y=new RegExp(k,"g"),z=new RegExp(l,"g"),a.match(z)==a?(A.validSyntax=!0,A.multiplex=a.match(v)?!0:!1,A.sync=a.match(w)?!0:!1,A.pass=a.match(y)?!0:!1,A.numJugglers=b):A.errorMessage="Invalid syntax"}function m(a,b,c,d,e,f){if(b.match(y)){var h=b.match(x);h.map(function(b,c){f=m(a,b,c,void 0,void 0,f)})}else if(b.match(w)){var h=b.split(",");f=m(a,h[0].substr(1),c,!0,i,f),f=m(a,h[1].substr(0,h[1].length-1),c,!0,k,f)}else if(b.match(v)){var h=b.match(u);h.map(function(b,d,g){f=m(a,b,c,void 0,e,f),d<g.length-1&&(0==f?f=A.dwellPath.length-1:f--)})}else{var j=b[0].charCodeAt(0)>=97&&b[0].charCodeAt(0)<=119?b[0].charCodeAt(0)-87:parseInt(b[0]),l=c,n=b.indexOf("P"),o=!1;n>0&&"}"!=b[n+1]&&(l=A.numJugglers>2?parseInt(b[n+1])-1:1-c,o=!0);var p=0,q=[],r=b.indexOf("B");if(r>0){if("{"!=b[r+1]||isNaN(b[r+2]))p=1,q=[0];else{p=parseInt(b[r+2]);for(var s=r+3;s<b.length&&!isNaN(b[s]);s++){var t=parseInt(b[s]);if(t>=A.surfaces.length)throw{message:"Bounce surface index out of range"};q.push(t)}}if(q.length<p)for(var z=q.length,s=0;p-z>s;s++)q.push(0)}var B=void 0;p>0&&(B=b.match("HF")?"HF":b.match("HL")?"HL":b.match("F")?"F":(b.match("L"),"L"));var C,D=b.indexOf("D");D>0&&(C=A.beatDuration*parseFloat(b.substring(D+2,b.indexOf("}"))));var E=b.indexOf("T"),F="standard";if(E>0){var G=b.substring(E+2,b.indexOf("}",E));G.match("C")?F="claw":G.match("P")&&(G="penguin")}var H=b.indexOf("C"),I="standard";if(H>0){var J=b.substring(H+2,b.indexOf("}",H));J.match("C")?I="claw":J.match("P")&&(I="penguin")}var K=j%2==1?!0:!1;b.length>1&&"x"==b[1]&&(K=!K),"R"==b[0]?e=k:"L"==b[0]&&(e=i);var L,M=g.normalize({x:.1,y:.1,z:1}),N=b.indexOf("S");if(N>0){var O=b.substring(N+2,b.indexOf("}",N)).match(/-?\d+(\.\d+)?/g);L=parseFloat(O[0]),O.length>1&&(M.x=parseFloat(O[1]),M.y=parseFloat(O[2]),M.z=parseFloat(O[3]),g.normalize(M))}else L=Math.floor(j/2)+.2,o&&(L+=.1);a.push({juggler:c,targetJuggler:l,hand:e,crossing:K,numBeats:j,siteswapStr:b,numBounces:p,bounceOrder:q,bounceType:B,numSpins:L,dwellPathIx:f,dwellDuration:void 0===C?A.dwellDuration:C,tossType:F,catchType:I,tossOrientation:M,rotationAxis:{x:1,y:0,z:0},hold:2!=j||K||-1!=b.indexOf("A")?!1:!0}),f==A.dwellPath.length-1?f=0:f++}return f}function n(){A.beats=a.match(A.pass?y:x);for(var b=0;b<A.beats.length;b++)A.beats[b].match(w)&&(A.beats.splice(b+1,0,"(0,0)"),b++);var d=0;if(A.beats.map(function(a){if(a.match(y))for(var b=a.split("|"),e=0;e<b.length;e++)0==e&&(b[e]=b[e].substr(1)),e==b.length-1&&(b[e]=b[e].substr(0,b[e].length-1)),d+=c(b[e]);else d+=c(a)}),!(d/A.beats.length%1==0&&d/A.beats.length>0))return void(A.errorMessage="Cannot determine number of props");for(A.numProps=d/A.beats.length;A.props.length<A.numProps;)A.props.push(g.cloneObject(A.props.last()));for(;A.props.length>A.numProps;)A.props.pop();A.tosses=[];for(var e=0,b=0;b<A.beats.length;b++){var f=[];e=m(f,A.beats[b],0,void 0,void 0,e),A.tosses.push(f),b==A.beats.length-1&&0!=e&&(b=-1)}A.maxHeight=0;for(var b=0;b<A.tosses.length;b++)for(var h=0;h<A.tosses[b].length;h++)A.tosses[b][h].numBeats>A.maxHeight&&(A.maxHeight=A.tosses[b][h].numBeats);for(var j=[],b=0;b<A.numProps;b++)j.push(b);A.states=[],A.propOrbits=[];for(var l=[],h=0;h<A.numJugglers;h++){l.push([[],[]]);for(var n=0;n<A.maxHeight;n++)l[h][i].push(void 0),l[h][k].push(void 0)}for(var o=!1,p=!1,q=0,r=i;!o;){for(var s=g.cloneObject(A.propOrbits),t=[],h=0;h<A.numJugglers;h++){var u=l[h][i].shift();if(u)for(var n=0;n<u.length;n++)t.push({propId:u[n],juggler:h,hand:i});var v=l[h][k].shift();if(v)for(var n=0;n<v.length;n++)t.push({propId:v[n],juggler:h,hand:k});l[h][i].push(void 0),l[h][k].push(void 0)}for(var h=0;h<A.tosses[q%A.tosses.length].length;h++){for(var z=A.tosses[q%A.tosses.length][h],B=void 0==z.hand?r:z.hand,C=z.crossing?1-B:B,D=void 0,n=0;n<t.length;n++)if(t[n].juggler==z.juggler&&t[n].hand==B){if(0==z.numBeats)return void(A.errorMessage="Prop landing on 0 toss at beat "+q);D=t.splice(n,1)[0].propId;break}if(void 0==D&&z.numBeats>0&&(D=j.shift()),void 0==D&&z.numBeats>0)return void(A.errorMessage="No prop available to toss at beat "+q);z.numBeats>0&&(s[D]||(s[D]=[]),s[D].push({beat:q,numBeats:z.numBeats,juggler:z.juggler,hand:B,numBounces:z.numBounces,bounceType:z.bounceType,bounceOrder:z.bounceOrder,numSpins:z.numSpins,dwellPathIx:z.dwellPathIx,dwellDuration:z.dwellDuration,tossType:z.tossType,catchType:z.catchType,tossOrientation:z.tossOrientation,rotationAxis:z.rotationAxis,hold:z.hold}),void 0==l[z.targetJuggler][C][z.numBeats-1]?l[z.targetJuggler][C][z.numBeats-1]=[D]:l[z.targetJuggler][C][z.numBeats-1].push(D))}if(p&&q%A.tosses.length==0&&g.arraysEqual(A.states[0],l)?o=!0:(A.states.push(g.cloneObject(l)),A.propOrbits=s),0!=j.length||(q+1)%A.tosses.length!=0||p||(p=!0,q=-1,A.states=[],A.propOrbits=[]),q++,r=1-r,q>1e3)return void(A.errorMessage="Pattern took more than 1000 beats to repeat states")}A.numSteps=A.states.length*A.numStepsPerBeat,A.validPattern=!0}function o(){try{h={};for(var a=[],b=0;b<A.numProps;b++)a.push([]);for(var c=[],b=0;b<A.numProps;b++)c.push([]);for(var d=[],b=0;b<A.numJugglers;b++)d.push([[],[]]);for(var e=[],b=0;b<A.numJugglers;b++)e.push([[],[]]);for(var f=0;f<A.numSteps;f++){for(var g=[],b=0;b<A.numJugglers;b++)g.push([void 0,void 0]);for(var l=Math.floor(f*A.states.length/A.numSteps),m=A.beatDuration*f*A.states.length/A.numSteps,n=0;n<A.numProps;n++){var o=void 0,u=void 0,v=void 0;1==A.propOrbits[n].length&&(o=A.propOrbits[n][0],u=A.propOrbits[n][0],v=A.propOrbits[n][0]);for(var w=!1,b=0;b<A.propOrbits[n].length-1;b++)!w&&A.propOrbits[n][b].beat<=l&&A.propOrbits[n][b+1].beat>l?(o=0==b?A.propOrbits[n][A.propOrbits[n].length-1]:A.propOrbits[n][b-1],u=A.propOrbits[n][b],v=A.propOrbits[n][b+1],w=!0):w||b!=A.propOrbits[n].length-2||(o=A.propOrbits[n][b],u=A.propOrbits[n][b+1],v=A.propOrbits[n][0]);var x=u.beat*A.beatDuration+u.dwellDuration,y=v.beat*A.beatDuration;x>y&&m>=y?y+=A.beatDuration*A.states.length:x>y&&y>m&&(x-=A.beatDuration*A.states.length);var z=o.beat*A.beatDuration+o.dwellDuration,B=u.beat*A.beatDuration;if(z>B&&m>=B?B+=A.beatDuration*A.states.length:z>B&&B>m&&(z-=A.beatDuration*A.states.length),x>m){var C=[],D=[];if(A.multiplex)for(var b=0;b<A.propOrbits.length;b++)if(b!=n)for(j=0;j<A.propOrbits[b].length;j++){var E=A.propOrbits[b][j];if(u.beat==E.beat&&u.juggler==E.juggler&&u.hand==E.hand){var F=j==A.propOrbits[b].length-1?A.propOrbits[b][0]:A.propOrbits[b][j+1],G=0==j?A.propOrbits[b][A.propOrbits[b].length-1]:A.propOrbits[b][j-1],H=E.beat*A.beatDuration+E.dwellDuration,I=F.beat*A.beatDuration;H>I&&m>=I?I+=A.beatDuration*A.states.length:H>I&&I>m&&(H-=A.beatDuration*A.states.length);var J=G.beat*A.beatDuration+G.dwellDuration,K=E.beat*A.beatDuration;J>K&&m>=K?K+=A.beatDuration*A.states.length:J>K&&K>m&&(J-=A.beatDuration*A.states.length),C.push(p(q(A.dwellPath[E.dwellPathIx],E.juggler,E.hand,1),q(A.dwellPath[F.dwellPathIx],F.juggler,F.hand,0),I-H,0,{numBounces:E.numBounces,bounceType:E.bounceType,bounceOrder:E.bounceOrder,R:A.props[b].radius,C:A.props[b].C})),D.push(p(q(A.dwellPath[G.dwellPathIx],G.juggler,G.hand,1),q(A.dwellPath[E.dwellPathIx],E.juggler,E.hand,0),K-J,K-J,{numBounces:G.numBounces,bounceType:G.bounceType,bounceOrder:G.bounceOrder,R:A.props[b].radius,C:A.props[b].C}))}}C.push(p(q(A.dwellPath[u.dwellPathIx],u.juggler,u.hand,1),q(A.dwellPath[v.dwellPathIx],v.juggler,v.hand,0),y-x,0,{numBounces:u.numBounces,bounceType:u.bounceType,bounceOrder:u.bounceOrder,R:A.props[n].radius,C:A.props[n].C})),D.push(p(q(A.dwellPath[o.dwellPathIx],o.juggler,o.hand,1),q(A.dwellPath[u.dwellPathIx],u.juggler,u.hand,0),B-z,B-z,{numBounces:o.numBounces,bounceType:o.bounceType,bounceOrder:o.bounceOrder,R:A.props[n].radius,C:A.props[n].C}));var L={dx:0,dy:0,dz:0,x:0,y:0,z:0},M={dx:0,dy:0,dz:0,x:0,y:0,z:0};for(b=0;b<D.length;b++)L.dx+=D[b].dx/D.length,L.dy+=D[b].dy/D.length,L.dz+=D[b].dz/D.length,L.x+=D[b].x/D.length,L.y+=D[b].y/D.length,L.z+=D[b].z/D.length,M.dx+=C[b].dx/D.length,M.dy+=C[b].dy/D.length,M.dz+=C[b].dz/D.length,M.x+=C[b].x/D.length,M.y+=C[b].y/D.length,M.z+=C[b].z/D.length;var N=1-(x-m)/u.dwellDuration,O=q(A.dwellPath[u.dwellPathIx],u.juggler,u.hand,N,L,M,A.dwellCatchScale,A.dwellTossScale),P=q(A.dwellPath[u.dwellPathIx],u.juggler,u.hand,0),Q={x:L.x-P.x,y:L.y-P.y,z:L.z-P.z};O.x+=(1-N)*Q.x,O.y+=(1-N)*Q.y,O.z+=(1-N)*Q.z;var R=Math.atan2(-L.dx,-L.dy),S=Math.atan2(M.dx,M.dy);"claw"==u.tossType?S-=Math.PI:"penguin"==u.tossTypeId&&(S-=2*Math.PI),"claw"==u.catchType?R-=Math.PI:"penguin"==u.catchType&&(R-=2*Math.PI),O.angle=R+N*(S-R),u.hand==k&&(O.angle*=-1),O.dwell=!0,a[n].push(O),void 0==g[u.juggler][u.hand]&&(g[u.juggler][u.hand]=O);var T=s(o.tossOrientation,o.rotationAxis,A.jugglers[o.juggler].rotation,2*o.numSpins*Math.PI,o.hand),U=s(u.tossOrientation,u.rotationAxis,A.jugglers[u.juggler].rotation,0,u.hand);T.slerp(U,N),c[n].push(T)}else{var O,V=y-x,N=m-x;if(u.hold){var W=q(A.dwellPath[u.dwellPathIx],u.juggler,u.hand,1),X=q(A.dwellPath[v.dwellPathIx],v.juggler,v.hand,0),Y=p(W,X,V,0),Z=p(W,X,V,V);O=q([A.dwellPath[u.dwellPathIx].last(),A.dwellPath[v.dwellPathIx][0]],u.juggler,u.hand,N/V,Y,Z,A.emptyTossScale,A.emptyCatchScale)}else O=p(q(A.dwellPath[u.dwellPathIx],u.juggler,u.hand,1),q(A.dwellPath[v.dwellPathIx],v.juggler,v.hand,0),V,N,{numBounces:u.numBounces,bounceType:u.bounceType,bounceOrder:u.bounceOrder,R:A.props[n].radius,C:A.props[n].C});O.dwell=!1,a[n].push(O);var $=2*u.numSpins*Math.PI,_=0,aa=_+N/V*($-_);c[n].push(s(u.tossOrientation,u.rotationAxis,A.jugglers[u.juggler].rotation,aa,u.hand))}}for(var ba=0;ba<A.numJugglers;ba++)for(var ca=0;1>=ca;ca++){if(void 0==g[ba][ca]){for(var v=void 0,da=void 0,ea=void 0,fa=void 0,ga=void 0,ha=void 0,ia=void 0,ja=void 0,ka=void 0,la=void 0,ma=void 0,na=void 0,oa=void 0,pa=void 0,n=0;n<A.propOrbits.length;n++)for(var qa=0;qa<A.propOrbits[n].length;qa++)A.propOrbits[n][qa].juggler==ba&&A.propOrbits[n][qa].hand==ca&&((void 0==da||A.propOrbits[n][qa].beat<da.beat)&&(da=A.propOrbits[n][qa],ga=n,ha=qa),A.propOrbits[n][qa].beat>l&&(void 0==v||A.propOrbits[n][qa].beat<v.beat)&&(v=A.propOrbits[n][qa],ia=n,ja=qa),(void 0==fa||A.propOrbits[n][qa].beat>fa.beat)&&(fa=A.propOrbits[n][qa],ka=n,la=qa),A.propOrbits[n][qa].beat<=l&&(void 0==ea||A.propOrbits[n][qa].beat>ea.beat)&&(ea=A.propOrbits[n][qa],ma=n,na=qa));void 0==v&&(v=da,ia=ga,ja=ha),void 0==ea&&(ea=fa,ma=ka,na=la),oa=0==ja?A.propOrbits[ia].last():A.propOrbits[ia][ja-1],pa=na==A.propOrbits[ma].length-1?A.propOrbits[ma][0]:A.propOrbits[ma][na+1];var ra=v.beat*A.beatDuration;m>ra&&(ra+=A.beatDuration*A.states.length);var sa=ea.beat*A.beatDuration+ea.dwellDuration;sa>m&&(sa-=A.beatDuration*A.states.length);var ta=pa.beat*A.beatDuration;sa>ta&&(ta+=A.beatDuration*A.states.length);var ua=oa.beat*A.beatDuration+oa.dwellDuration;ua>ra&&(ua-=A.beatDuration*A.states.length);var Y=p(q(A.dwellPath[ea.dwellPathIx],ea.juggler,ea.hand,1),q(A.dwellPath[pa.dwellPathIx],pa.juggler,pa.hand,0),ea.numBeats*A.beatDuration-ea.dwellDuration,0,{numBounces:ea.numBounces,bounceType:ea.bounceType,bounceOrder:ea.bounceOrder,R:A.props[ma].radius,C:A.props[ma].C}),Z=p(q(A.dwellPath[oa.dwellPathIx],oa.juggler,oa.hand,1),q(A.dwellPath[v.dwellPathIx],v.juggler,v.hand,0),oa.numBeats*A.beatDuration-oa.dwellDuration,oa.numBeats*A.beatDuration-oa.dwellDuration,{numBounces:oa.numBounces,bounceType:oa.bounceType,bounceOrder:oa.bounceOrder,R:A.props[ia].radius,C:A.props[ia].C}),N=(m-sa)/(ra-sa),O=q([A.dwellPath[ea.dwellPathIx].last(),A.dwellPath[v.dwellPathIx][0]],ea.juggler,ea.hand,N,Y,Z,A.emptyTossScale,A.emptyCatchScale),va=q([A.dwellPath[ea.dwellPathIx].last(),A.dwellPath[v.dwellPathIx][0]],ea.juggler,ea.hand,1),wa={x:Z.x-va.x,y:Z.y-va.y,z:Z.z-va.z};O.x+=N*wa.x,O.y+=N*wa.y,O.z+=N*wa.z;var R=Math.atan2(-Z.dx,-Z.dy),S=Math.atan2(Y.dx,Y.dy);"claw"==ea.tossType?S-=Math.PI:"penguin"==ea.tossType&&(S-=2*Math.PI),"claw"==v.catchType?R-=Math.PI:"penguin"==v.catchType&&(R-=2*Math.PI),O.angle=S+N*(R-S),ca==k&&(O.angle*=-1),g[ba][ca]=O}d[ba][ca].push(g[ba][ca]),e[ba][ca].push(r({x:A.jugglers[ba].position.x+Math.cos(A.jugglers[ba].rotation)*(ca==i?-1:1)*.225,y:1.425,z:A.jugglers[ba].position.z+Math.sin(A.jugglers[ba].rotation)*(ca==i?-1:1)*.225},g[ba][ca],.45,A.armAngle,ca))}}A.propPositions=a,A.propRotations=c,A.jugglerHandPositions=d,A.jugglerElbowPositions=e,A.collision=t()}catch(xa){A.errorMessage=xa.message}}function p(a,b,c,d,f){c=parseFloat(c.toFixed(2)),void 0==f&&(f={}),f.bounceType||(f.bounceType="L"),f.dt||(f.dt=.01),f.eps||(f.eps=.01),f.dv||(f.dv=.01),f.numBounces||(f.numBounces=0),f.bounceOrder||(f.bounceOrder=[0]),f.G||(f.G=-9.8),f.C||(f.C=.95),f.tries||(f.tries=1e4),f.R||(f.R=.1);var g=JSON.stringify({p0:a,p1:b,T:c,options:f});if(0==f.numBounces)return{x:a.x+(b.x-a.x)*d/c,y:a.y+(b.y-a.y-.5*f.G*c*c)*d/c+.5*f.G*d*d,z:a.z+(b.z-a.z)*d/c,dx:(b.x-a.x)/c,dy:(b.y-a.y-.5*f.G*c*c)/c+f.G*d,dz:(b.z-a.z)/c};if(void 0==h[g]){var i={p0:a,pT:b,minT:c,maxT:c,R:f.R,C:f.C,dt:f.dt,G:-9.8,numBounces:f.numBounces,surfaceBounceOrder:f.bounceOrder,tossSign:"L"==f.bounceType||"HL"==f.bounceType?1:-1,catchSign:"L"==f.bounceType||"HF"==f.bounceType?1:-1,surfaces:A.surfaces},j={maxGenerations:500,populationSize:50,mutationChance:.7,mutationScale:5,initialScale:20,fitnessThreshold:.05,noGA:!1};if(ga=new e.BounceGA(j,i),ga.evolve(),!ga.ableToFindSolution)throw{message:"Unable to calculate bounce path"};var k=ga.getBouncePath(ga.fittestMembers[ga.fittestMembers.length-1].v);h[g]={path:k.path,velocities:k.velocities}}var l=h[g];return{x:l.path[Math.floor((l.path.length-1)*d/c)].x,y:l.path[Math.floor((l.path.length-1)*d/c)].y,z:l.path[Math.floor((l.path.length-1)*d/c)].z,dx:l.velocities[Math.floor((l.velocities.length-1)*d/c)].x,dy:l.velocities[Math.floor((l.velocities.length-1)*d/c)].y,dz:l.velocities[Math.floor((l.velocities.length-1)*d/c)].z}}function q(a,b,c,d,e,g,h,j,k){c==i&&(e||g)&&(e.dx*=-1,g.dx*=-1);var l=f.interpolateBezierSpline(a,d,e,g,h,j,k);return{x:A.jugglers[b].position.x+(c==i?-1:1)*l.x*Math.cos(A.jugglers[b].rotation)-(l.z-.4125)*Math.sin(A.jugglers[b].rotation),y:1.0125+l.y,z:A.jugglers[b].position.z+(c==i?-1:1)*l.x*Math.sin(A.jugglers[b].rotation)+(l.z-.4125)*Math.cos(A.jugglers[b].rotation)}}function r(a,b,c,d,e){var f={};f.x=b.x-a.x,f.y=b.y-a.y,f.z=b.z-a.z;var g={};g.x=Math.sqrt(f.x*f.x+f.z*f.z),g.y=f.y,g.z=0;var h=Math.atan2(f.z,f.x),i=Math.sqrt(f.x*f.x+f.y*f.y+f.z*f.z);i>2*c&&(c=i/2);var j={};j.x=g.y/i,j.y=-g.x/i,j.z=0;var k={x:0,y:0};k.z=1==e?-1:1;var l=Math.sqrt(c*c-.25*i*i),m={};m.x=g.x/2+l*j.x*Math.cos(d)+l*k.x*Math.sin(d),m.y=g.y/2+l*j.y*Math.cos(d)+l*k.y*Math.sin(d),m.z=g.z/2+l*j.z*Math.cos(d)+l*k.z*Math.sin(d);var n={};n.x=m.x*Math.cos(h)+m.z*Math.sin(h),n.y=m.y,n.z=m.x*Math.sin(h)+m.z*Math.cos(h);var o={};return o.x=n.x+a.x,o.y=n.y+a.y,o.z=n.z+a.z,o}function s(a,b,c,d,e){T=new THREE.Vector3(a.x,a.y,a.z),R=new THREE.Vector3(b.x,b.y,b.z),C=new THREE.Vector3(0,-1,0),e==i&&(T.x*=-1,R.x*=-1);var f=new THREE.Quaternion;f.setFromAxisAngle(new THREE.Vector3(0,-1,0),c),T.applyQuaternion(f);var g=new THREE.Quaternion;g.setFromAxisAngle(new THREE.Vector3(T.z,0,-T.x),Math.acos(T.y));var h=new THREE.Quaternion;h.setFromAxisAngle(new THREE.Vector3(0,1,0),Math.acos(-R.z*T.x+R.x*T.z)),R.applyQuaternion(h);var j=new THREE.Quaternion;j.setFromAxisAngle(R,d);var k=new THREE.Quaternion;return k=(new THREE.Quaternion).multiplyQuaternions(g,j)}function t(){for(var a,b,c=0;c<A.propPositions.length;c++){a=A.props[c].radius;for(var d=0;d<A.propPositions[c].length;d++)for(var e=c+1;e<A.propPositions.length;e++)if(b=A.props[c].radius,Math.sqrt(Math.pow(A.propPositions[c][d].x-A.propPositions[e][d].x,2)+Math.pow(A.propPositions[c][d].y-A.propPositions[e][d].y,2)+Math.pow(A.propPositions[c][d].z-A.propPositions[e][d].z,2))<=a+b)return!0}return!1}var u,v,w,x,y,z,A={siteswap:a,validSyntax:!1,validPattern:!1,collision:void 0,multiplex:void 0,sync:void 0,pass:void 0,numJugglers:void 0,numProps:void 0,maxHeight:void 0,tosses:void 0,beats:void 0,states:void 0,propOrbits:void 0,propPositions:void 0,propRotations:void 0,jugglerHandPositions:void 0,jugglerElbowPositions:void 0,jugglers:void 0,validationOnly:void 0,numStepsPerBeat:void 0,numSteps:void 0,beatDuration:void 0,dwellDuration:void 0,props:void 0,dwellPath:void 0,tossMatchVelocity:void 0,catchMatchVelocity:void 0,dwellCatchScale:void 0,dwellTossScale:void 0,emptyTossScale:void 0,emptyCatchScale:void 0,armAngle:void 0,surfaces:void 0,errorMessage:void 0};return l(),d(),A.errorMessage?A:(n(),A.errorMessage?A:(A.validationOnly||o(),A))}var e=a("./BounceGA.js"),f=a("./Bezier.js"),g=a("./util.js"),h={},i=0,k=1;b.exports.CreateSiteswap=d},{"./Bezier.js":1,"./BounceGA.js":2,"./util.js":7}],4:[function(a,b){b.exports.SiteswapAnimator=function(a,b){function c(){B.surfaces.map(function(a){var b={position:new THREE.Vector3(a.position.x,a.position.y,a.position.z),normal:new THREE.Vector3(a.normal.x,a.normal.y,a.normal.z),axis1:new THREE.Vector3(a.axis1.x,a.axis1.y,a.axis1.z),axis2:new THREE.Vector3(a.axis2.x,a.axis2.y,a.axis2.z),scale:a.scale},c=new THREE.Geometry;c.vertices.push((new THREE.Vector3).copy(b.position).add((new THREE.Vector3).add(b.axis1).add(b.axis2))),c.vertices.push((new THREE.Vector3).copy(b.position).add((new THREE.Vector3).add(b.axis1).negate().add(b.axis2))),c.vertices.push((new THREE.Vector3).copy(b.position).add((new THREE.Vector3).add(b.axis1).add(b.axis2).negate())),c.vertices.push((new THREE.Vector3).copy(b.position).add((new THREE.Vector3).add(b.axis2).negate().add(b.axis1))),c.faces.push(new THREE.Face3(0,1,2)),c.faces.push(new THREE.Face3(2,0,3));var d=new THREE.Mesh(c,new THREE.MeshBasicMaterial({color:"grey",side:THREE.DoubleSide}));K.push(d),s.add(d)})}function d(a){return new THREE.Vector3(a.x,a.y,a.z)}function e(){function a(a,c,d){return new THREE.Vector3(B.jugglers[b].position.x+(Math.cos(B.jugglers[b].rotation)*a-Math.sin(B.jugglers[b].rotation)*d),c,B.jugglers[b].position.z+(Math.cos(B.jugglers[b].rotation)*d+Math.sin(B.jugglers[b].rotation)*a))}for(var b=0;b<B.numJugglers;b++){x.push([[],[]]),y.push([[],[]]);var c=new THREE.Object3D,d=new THREE.Geometry;d.vertices.push(a(-.125,0,0)),d.vertices.push(a(0,.8,0)),d.vertices.push(a(.125,0,0));var e=new THREE.Line(d,new THREE.LineBasicMaterial({color:"black"})),f=new THREE.Geometry;f.vertices.push(a(0,.8,0)),f.vertices.push(a(0,1.5,0));var g=new THREE.Line(f,new THREE.LineBasicMaterial({color:"black"})),h=new THREE.Geometry;h.vertices.push(a(-.225,1.425,0)),h.vertices.push(a(.225,1.425,0));for(var i=new THREE.Line(h,new THREE.LineBasicMaterial({color:"black"})),j=-1;1>=j;j+=2){var k=-1==j?0:1;armG=new THREE.Geometry,armG.vertices.push(a(.225*j,1.425,0)),y[b][k]=a(.225*j,1.0125,0),armG.vertices.push(y[b][k]),x[b][k].push(a(.225*j,1.0125,-.4125)),armG.vertices.push(x[b][k][0]),armG.dynamic=!0;var l=new THREE.Line(armG,new THREE.LineBasicMaterial({color:"black"}));if(c.add(l),O){var m=new THREE.Geometry;x[b][k].push(new THREE.Vector3),x[b][k].push(new THREE.Vector3),x[b][k].push(new THREE.Vector3),x[b][k].push(new THREE.Vector3),m.vertices.push(x[b][k][1]),m.vertices.push(x[b][k][2]),m.vertices.push(x[b][k][3]),m.vertices.push(x[b][k][4]),m.faces.push(new THREE.Face3(0,1,2)),m.faces.push(new THREE.Face3(2,0,3)),m.dynamic=!0;var n=new THREE.Mesh(m,new THREE.MeshBasicMaterial({color:"black",side:THREE.DoubleSide}));c.add(n);var o=new THREE.Geometry;x[b][k].push(new THREE.Vector3),x[b][k].push(new THREE.Vector3),x[b][k].push(new THREE.Vector3),o.vertices.push(x[b][k][5]),o.vertices.push(x[b][k][6]),o.vertices.push(x[b][k][7]),o.dynamic=!0;var p=new THREE.Line(o,new THREE.LineBasicMaterial({color:"black"}));c.add(p),o=new THREE.Geometry,x[b][k].push(new THREE.Vector3),x[b][k].push(new THREE.Vector3),x[b][k].push(new THREE.Vector3),o.vertices.push(x[b][k][8]),o.vertices.push(x[b][k][9]),o.vertices.push(x[b][k][10]),o.dynamic=!0,p=new THREE.Line(o,new THREE.LineBasicMaterial({color:"black"})),c.add(p),o=new THREE.Geometry,x[b][k].push(new THREE.Vector3),x[b][k].push(new THREE.Vector3),x[b][k].push(new THREE.Vector3),o.vertices.push(x[b][k][11]),o.vertices.push(x[b][k][12]),o.vertices.push(x[b][k][13]),o.dynamic=!0,p=new THREE.Line(o,new THREE.LineBasicMaterial({color:"black"})),c.add(p),o=new THREE.Geometry,x[b][k].push(new THREE.Vector3),x[b][k].push(new THREE.Vector3),x[b][k].push(new THREE.Vector3),o.vertices.push(x[b][k][14]),o.vertices.push(x[b][k][15]),o.vertices.push(x[b][k][16]),o.dynamic=!0,p=new THREE.Line(o,new THREE.LineBasicMaterial({color:"black"})),c.add(p)}}var q=new THREE.Mesh(new THREE.SphereGeometry(.1125,20),new THREE.MeshPhongMaterial({color:"black"}));q.position=new THREE.Vector3(B.jugglers[b].position.x+0*Math.cos(B.jugglers[b].rotation),1.6125,B.jugglers[b].position.z+0*Math.sin(B.jugglers[b].rotation)),c.add(e),c.add(g),c.add(i),c.add(q),s.add(c),J.push(c)}}function f(){for(var a=0;a<B.propPositions.length;a++){for(var b=new THREE.Geometry,c=0;c<B.propPositions[a].length;c++){var d=B.propPositions[a][c],e=.001;b.vertices.push(new THREE.Vector3(d.x+(Math.random()-.5)*e,d.y+(Math.random()-.5)*e,d.z+(Math.random()-.5)*e))}var f=new THREE.Line(b,new THREE.LineBasicMaterial({color:B.props[a].color}));L.push(f),s.add(f)}}function g(a){for(var b=0;b<x.length;b++){for(var c=0;2>c;c++)if(O)for(var e=.03,f=.03,g=[new THREE.Vector3(0,0,e+f),new THREE.Vector3(-e,0,-e+f),new THREE.Vector3(e,0,-e+f),new THREE.Vector3(e,0,e+f),new THREE.Vector3(-e,0,e+f),new THREE.Vector3(0,0,-e+f),new THREE.Vector3(0,.01,-2*e+f),new THREE.Vector3(0,.05,-3*e+f),new THREE.Vector3(e,0,-e+f),new THREE.Vector3(e,.01,-2*e+f),new THREE.Vector3(e,.05,-3*e+f),new THREE.Vector3(-e,0,-e+f),new THREE.Vector3(-e,.01,-2*e+f),new THREE.Vector3(-e,.05,-3*e+f),new THREE.Vector3((0==c?-1:1)*e,0,e+f),new THREE.Vector3(2*(0==c?-1:1)*e,0,e+f-.02),new THREE.Vector3(2*(0==c?-1:1)*e,.02,e+f-.04)],h=B.jugglerHandPositions[b][c][a].angle,i=B.props[0].radius,j=d(B.jugglerHandPositions[b][c][a]).add(new THREE.Vector3(i*Math.sin(h),-i*Math.cos(h),0)),k=-Math.atan2(B.jugglerElbowPositions[b][c][a].x-B.jugglerHandPositions[b][c][a].x,B.jugglerElbowPositions[b][c][a].z-B.jugglerHandPositions[b][c][a].z),l=0;l<g.length;l++){var m=g[l].x*Math.cos(h)-g[l].y*Math.sin(h),n=g[l].y*Math.cos(h)+g[l].x*Math.sin(h);m=m*Math.cos(k)-g[l].z*Math.sin(k);

var o=g[l].z*Math.cos(k)+m*Math.sin(k);g[l].x=m,g[l].y=n,g[l].z=o,x[b][c][l].copy((new THREE.Vector3).copy(j).add(g[l]))}else x[b][c][0].copy(d(B.jugglerHandPositions[b][c][a]));y[b][0].x=B.jugglerElbowPositions[b][0][a].x,y[b][0].y=B.jugglerElbowPositions[b][0][a].y,y[b][0].z=B.jugglerElbowPositions[b][0][a].z,y[b][1].x=B.jugglerElbowPositions[b][1][a].x,y[b][1].y=B.jugglerElbowPositions[b][1][a].y,y[b][1].z=B.jugglerElbowPositions[b][1][a].z}}function h(){if("sky"==H.mode){r.position.x=F*Math.sin(D)*Math.cos(E),r.position.y=F*Math.sin(E),r.position.z=F*Math.cos(D)*Math.cos(E);var a=new THREE.Vector3(0,0,0);if(void 0!==B){for(var b=0;b<B.jugglers.length;b++)a.x+=B.jugglers[b].position.x,a.z+=B.jugglers[b].position.z;a.x/=B.jugglers.length,a.z/=B.jugglers.length,a.y=z/2}r.lookAt(a)}else if("juggler"==H.mode)r.position.x=0,r.position.y=1.6125,r.position.z=0,r.lookAt(new THREE.Vector3(Math.sin(D)*Math.cos(E),1.6125-Math.sin(E),Math.cos(D)*Math.cos(E)));else if("custom"==H.mode){var c=new THREE.Vector3(H.x,H.y,H.z);r.position=c,r.lookAt(new THREE.Vector3(c.x-Math.sin(D)*Math.cos(E),c.y-Math.sin(E),c.z-Math.cos(D)*Math.cos(E)))}}function i(a){G=!0,u=D,v=E,w.x=a.clientX,w.y=a.clientY}function j(a){G=!0,u=D,v=E,w.x=a.changedTouches[0].clientX,w.y=a.changedTouches[0].clientY}function k(a){if(a.preventDefault(),G){D=-(.01*(a.clientX-w.x))+u;var b=a.clientY-w.y,c=.01*b+v;c<Math.PI/2&&c>-Math.PI/2&&(E=c)}h(),t.render(s,r)}function l(a){if(a.preventDefault(),G){D=-(.01*(a.changedTouches[0].clientX-w.x))+u;var b=a.changedTouches[0].clientY-w.y,c=.01*b+v;c<Math.PI/2&&c>-Math.PI/2&&(E=c)}h(),t.render(s,r)}function m(a){a.preventDefault(),G=!1}function n(a){F-=.002*a.wheelDeltaY}var o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=Math.PI,E=.7,F=5,G=!1,H={mode:"sky"},I=[],J=[],K=[],L=[],M="3D",N=["red","blue","green","black","yellow","purple"],O=!1;this.displayPropPaths=b.displayPropPaths===!0?!0:!1,o=$("#"+a),p=o.width(),q=o.height(),"2D"==M?(o.append('<canvas id="siteswapAnimatorCanvas"></canvas>'),canvas=o.find("canvas")[0],canvas.height=q,canvas.width=p,C=canvas.getContext("2d"),C.clearRect(0,0,p,q)):"3D"==M&&(r=new THREE.PerspectiveCamera(90,p/q,.05,100),h(),s=new THREE.Scene,t=window.WebGLRenderingContext?new THREE.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0}):new THREE.CanvasRenderer,t.setSize(p,q),o.empty(),o.append(t.domElement),t.domElement.addEventListener("mousemove",k,!1),t.domElement.addEventListener("touchmove",l,!1),t.domElement.addEventListener("mousedown",i,!1),t.domElement.addEventListener("touchstart",j,!1),t.domElement.addEventListener("mouseup",m,!1),t.domElement.addEventListener("touchend",m,!1),t.domElement.addEventListener("mousewheel",n,!1),w=new THREE.Vector2,t.setClearColor(16777215,1),t.render(s,r),this.renderer=t,this.oneCycleComplete=!1,this.paused=!1,this.animationSpeed=.6),this.resize=function(a,b){p=a,q=b,r=new THREE.PerspectiveCamera(75,p/q,.05,100),h(),t.setSize(p,q)},this.init=function(a,b){if(this.paused=!1,A=0,B=a,B.errorMessage)$("#errorMessage").html("ERROR: "+B.errorMessage),$("#errorMessage").show();else{if(B.pass)for(var d=0;d<B.props.length;d++)if("club"==B.props[d].type||"club"==B.props[d].type){$("#errorMessage").html("WARNING: Passing patterns with clubs/rings may look weird. Still working out kinks with prop orientation."),$("#errorMessage").show();break}z=0;for(var d=0;d<B.propPositions.length;d++)for(var g=0;g<B.propPositions[d].length;g++)B.propPositions[d][g].y>z&&(z=B.propPositions[d][g].y);F=z+.5;for(var d=s.children.length-1;d>=0;d--)s.remove(s.children[d]);var h=new THREE.PointLight(16777215);h.position.set(0,20,0),s.add(h);var i=new THREE.PointLight(16777215);i.position.set(0,0,-2),s.add(i),I=[],J=[],x=[],y=[],L=[],O=b.drawHands?b.drawHands:0,c(),e();for(var d=0;d<B.numProps;d++){var j;if("ball"==B.props[d].type)j=new THREE.SphereGeometry(B.props[d].radius,20);else if("club"==B.props[d].type){j=new THREE.CylinderGeometry(.008,.02,.02,7,5),j.vertices.map(function(a){a.y+=.01});var k=new THREE.CylinderGeometry(.015,.008,.18,7,5);k.vertices.map(function(a){a.y+=.11});var l=new THREE.CylinderGeometry(.04,.015,.18,7,5);l.vertices.map(function(a){a.y+=.29});var m=new THREE.CylinderGeometry(.02,.04,.11,7,5);m.vertices.map(function(a){a.y+=.43}),THREE.GeometryUtils.merge(j,k),THREE.GeometryUtils.merge(j,l),THREE.GeometryUtils.merge(j,m),j.vertices.map(function(a){a.y-=.2})}else if("ring"==B.props[d].type){var n=[];n.push(new THREE.Vector3(.14,0,.01)),n.push(new THREE.Vector3(.18,0,.01)),n.push(new THREE.Vector3(.18,0,-.01)),n.push(new THREE.Vector3(.14,0,-.01)),n.push(new THREE.Vector3(.14,0,.01)),j=new THREE.LatheGeometry(n)}if(b.motionBlur)var o=2;else var o=0;for(var p=[],q="random"==B.props[d].color?N[Math.floor(Math.random()*N.length)]:B.props[d].color,g=0;o>=g;g++){var r;r=new THREE.MeshLambertMaterial(0==g?{color:q}:{color:q,transparent:!0,opacity:1-1/(o+1)*g});var t=new THREE.Mesh(j,r);s.add(t),p.push(t)}I.push(p)}this.displayPropPaths&&f()}},this.animate=function(){0===A&&(A=(new Date).getTime());var a=((new Date).getTime()-A)*this.animationSpeed;a>B.states.length*B.beatDuration*1e3&&(this.oneCycleComplete=!0);var b=a%(B.states.length*B.beatDuration*1e3);if(this.render(b),!this.paused){var c=this;requestAnimationFrame(function(){c.animate()})}},this.render=function(a){for(var b=Math.floor(a/(B.states.length*B.beatDuration*1e3)*B.numSteps),c=0;c<I.length;c++)for(var d=0;d<I[c].length;d++){var e=b-d*Math.floor(B.numStepsPerBeat/8);if(0>e&&(e+=B.numSteps),I[c][d].position.x=B.propPositions[c][e].x,I[c][d].position.y=B.propPositions[c][e].y,I[c][d].position.z=B.propPositions[c][e].z,I[c][d].quaternion.set(1,0,0,0),"ring"==B.props[c].type){var f=new THREE.Quaternion;f.setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI/2),I[c][d].quaternion.multiply(f)}var i=B.propRotations[c][e];I[c][d].quaternion.multiplyQuaternions(i,I[c][d].quaternion)}g(b),h();for(var c=0;c<J.length;c++)for(var d=0;d<J[c].children.length;d++)J[c].children[d].geometry.verticesNeedUpdate=!0;try{t.render(s,r)}catch(j){console.log("Error rendering")}},this.hidePropPaths=function(){L.map(function(a){a.visible=!1})},this.showPropPaths=function(){0==L.length?f():L.map(function(a){a.visible=!0})},this.zoomIn=function(){F-=.1},this.zoomOut=function(){F+=.1},this.updateAnimationSpeed=function(a){this.animationSpeed=a},this.updateCameraMode=function(a){H=a}}},{}],5:[function(a,b){Array.prototype.last||(Array.prototype.last=function(){return this[this.length-1]}),Array.prototype.sum||(Array.prototype.sum=function(){return this.reduce(function(a,b){return a+b})}),b.exports.siteswapGraph=function(a,b){function c(b,d,f){if(b.length==a.maxPeriod){if(b.reduce(function(a,b){return a+b})==a.numProps&&h.push({value:b,edges:[]}),a.callbacks.updateGraphProgress){var g=1;a.callbacks.updateGraphProgress(g)}f&&e()}else d.map(function(d,e,f){var g=b.slice();g.push(d);var h=g.reduce(function(a,b){return a+b})-a.numProps,i=[];i=0==h?[0]:1==h?[1,0]:a.includeMultiplex?[1,2,0]:[1,0];var j=this.last&&e==f.length-1;a.async?setTimeout(c,0,g,i,j):c(g,i,j)},{last:f})}function d(a,b){var c=[],d=a[0],e=a.slice(1,a.length);e.push(0);var f=!1;0==d?c.push("0"):d>1?(f=!0,c.push("[")):c.push("");for(var g=0;g<e.length;g++){var h=g+1;if(h>9&&(h=String.fromCharCode(87+h)),e[g]!=b[g]){if(!(d>=b[g]-e[g]))return[];c[0]+=h,d--,1==d&&b[g]-e[g]==2&&(c[0]+=h,d--)}}return f&&(c[0]+="]"),c}function e(){function b(a,b){for(var c=d(h[a].value,h[b].value),e=0;e<c.length;e++)h[a].edges.push(i.push({source:a,target:b,value:c[e]})-1)}for(var c=0;c<h.length;c++){if(a.callbacks.updateGraphProgress){var e=(c+1)/h.length;a.callbacks.updateGraphProgress(e)}for(var f=0;f<h.length;f++)setTimeout(b,0,c,f)}a.callbacks.graphDone&&setTimeout(a.callbacks.graphDone),a.async?setTimeout(g,0,0,[]):g(0,[])}function f(b,c){if(b.length!=c.length)return!1;for(var d=0;d<=b.length;d++){if(b.toString()==c.toString())return!0;b.push(b[0]),b=b.slice(1),a.sync&&(b.push(b[0]),b=b.slice(1))}}function g(b,c){if(l++,l<=a.maxSearches&&j.length<a.maxSiteswaps){var d=b,e=!1,m=void 0;if(c.length>0&&c.length<=a.maxPeriod){if(c.length>=a.minPeriod&&(!a.sync||c.length%2==0))if(i[c.last()].target==b)e=!0,m=0;else if(a.includeExcited)for(var n=0;n<c.length;n++)i[c.last()].target!=i[c[n]].source||a.sync&&n%2!=0||(e=!0,m=n);if(e){for(var o=c.map(function(b,c){if(a.sync){for(var d="",e=i[b].value,f=0;f<e.length;f++)d+="["==e[f]||"]"==e[f]||parseInt(e[f])%2==0?e[f]:c%2==0?parseInt(e[f])-1+"x":parseInt(e[f])+1+"x";return d}return i[b].value}).slice(m),p=!1,n=0;n<j.length;n++){var q=j[n].map(function(b,c){if(a.sync){for(var d="",e=i[b].value,f=0;f<e.length;f++)d+="["==e[f]||"]"==e[f]||parseInt(e[f])%2==0?e[f]:c%2==0?parseInt(e[f])-1+"x":parseInt(e[f])+1+"x";return d}return i[b].value});if(f(q,o.slice())){p=!0;break}}if(!p){var r=j.push(c.slice(m))-1;if(a.callbacks.siteswapFound){for(var n=0;n<o.length;n++)o[n]>9&&(o[n]=String.fromCharCode(87+parseInt(o[n])));var s="";if(a.sync)for(var n=0;n<o.length;n++)s+=n%2==0?"("+o[n]+",":o[n]+")";else s=o.join("");k.push(s),a.callbacks.siteswapFound(s,r,m>0)}}e=!0}d=i[c.last()].target}(!e||m>0)&&c.length<a.maxPeriod&&h[d].edges.map(function(d){function e(){for(var e=!1,f=!1,h=0;h<a.exclude.length;h++)if(a.exclude[h]==i[d].value){f=!0;break}if(a.sync&&c.length%2==0&&i[d].value.indexOf(1)>-1&&(f=!0),!e&&!f){var j=c.slice();j.push(d),g(b,j)}}a.async?setTimeout(e,0):e()})}}a.minPeriod=void 0===a.minPeriod?[]:a.minPeriod,a.async=void 0===a.async?[]:a.async,a.callbacks=void 0===a.callbacks?[]:a.callbacks,a.exclude=void 0===a.exclude?[]:a.exclude,a.includeExcited=void 0===a.includeExcited?!0:a.includeExcited,a.maxSearches=void 0===a.maxSearches?99999999:a.maxSearches,a.maxSiteswaps=void 0===a.maxSiteswaps?1e3:a.maxSiteswaps,a.includeMultiplex=void 0===a.includeMultiplex?!1:a.includeMultiplex,a.sync=void 0===a.sync?!1:a.sync,b=void 0===b?{}:b;var h=[],i=[],j=[],k=[];b.graph={nodes:h,edges:i,siteswaps:j,formattedSiteswaps:k};var l=0,m=[];return m.push(1),m.push(0),a.includeMultiplex&&m.push(2),a.async?setTimeout(c,0,[],m.slice(),!0):c([],m.slice(),!0),a.async?void 0:b}},{}],6:[function(a){function b(a){$(".controlDiv").hide(),$("#"+a+"Menu").show(),$("#nav a").removeClass("selected"),$("#nav a").addClass("unselected"),$("#nav #"+a).addClass("selected"),$("#nav #"+a).removeClass("unselected"),window.onresize()}function c(){e(d({siteswap:$("#siteswap").val(),props:[{type:$("#prop").val(),color:"red",radius:.05,C:.97}],beatDuration:$("#beatDuration").val(),dwellPath:$("#dwellPath").val()})),m()}function d(a){return a.siteswap=void 0===a.siteswap?"3":a.siteswap,a.props=void 0===a.props?[{type:"ball",color:"red",radius:".05",C:.97}]:a.props,a.beatDuration=void 0===a.beatDuration?.28:a.beatDuration,a.dwellRatio=void 0===a.dwellRatio?.8:a.dwellRatio,a.dwellPath=void 0===a.dwellPath?"(30)(10)":a.dwellPath,a.matchVelocity=void 0===a.matchVelocity?0:a.matchVelocity,a.dwellCatchScale=void 0===a.dwellCatchScale?.06:a.dwellCatchScale,a.dwellTossScale=void 0===a.dwellTossScale?.06:a.dwellTossScale,a.emptyTossScale=void 0===a.emptyTossScale?.025:a.emptyTossScale,a.emptyCatchScale=void 0===a.emptyCatchScale?.025:a.emptyCatchScale,a.armAngle=void 0===a.armAngle?.1:a.armAngle,a.jugglers=void 0===a.jugglers?[{position:{x:0,z:0},rotation:0}]:a.jugglers,a.surfaces=void 0===a.surfaces?[{position:{x:0,y:0,z:0},normal:{x:0,y:1,z:0},scale:2}]:a.surfaces,a}function e(a){var b=a.siteswap+"\n";b+=a.beatDuration+" "+a.dwellRatio+"\n";for(var c=0;c<a.props.length;c++)b+=a.props[c].type+" "+a.props[c].color+" "+a.props[c].radius+" "+a.props[c].C,b+=c<a.props.length-1?" ":"\n";b+=a.dwellPath+"\n",b+=a.matchVelocity+" "+a.dwellCatchScale+" "+a.dwellTossScale+" "+a.emptyTossScale+" "+a.emptyCatchScale+" "+a.armAngle+"\n";for(var c=0;c<a.jugglers.length;c++)b+=a.jugglers[c].position.x+" "+a.jugglers[c].position.z+" "+a.jugglers[c].rotation,c<a.jugglers.length-1&&(b+=" ");a.surfaces.length>0&&(b+="\n");for(var c=0;c<a.surfaces.length;c++)b+=a.surfaces[c].position.x+" "+a.surfaces[c].position.y+" "+a.surfaces[c].position.z+" "+a.surfaces[c].normal.x+" "+a.surfaces[c].normal.y+" "+a.surfaces[c].normal.z+" "+a.surfaces[c].scale,c<a.surfaces.length-1&&(b+="\n");$("#inputsAdvanced").val(b),m()}function f(a){for(var b=a.split("\n"),c=b[0],d=parseFloat(b[1].split(" ")[0]),e=parseFloat(b[1].split(" ")[1]),f=b[2].split(" "),g=[],h=3;h<f.length;h+=4)g.push({type:f[h-3],color:f[h-2],radius:parseFloat(f[h-1]),C:parseFloat(f[h])});for(var i=b[3],j=i.split(").").map(function(a,b,c){return b<c.length-1?a+")":a}),k=[],h=0;h<j.length;h++){var l=j[h].match(/\(-?\d+(\.\d+)?(,-?\d+(\.\d+)?)?(,-?\d+(\.\d+)?)?(,\{-?\d+(\.\d+)?,-?\d+(\.\d+)?,-?\d+(\.\d+)?,-?\d+(\.\d+)?\})?\)/g);if(l.reduce(function(a,b){return a+b}).length!=j[h].length)throw"Invalid custom dwell path";k.push(l.map(function(a,b){var c,d=a.match(/\(-?\d+(\.\d+)?(,-?\d+(\.\d+)?)?(,-?\d+(\.\d+)?)?/g)[0].match(/-?\d+(\.\d+)?/g),e=a.match(/\{-?\d+(\.\d+)?,-?\d+(\.\d+)?,-?\d+(\.\d+)?,-?\d+(\.\d+)?\}/g);e&&(c=e[0].match(/-?\d+(\.\d+)?/g));var f;return f=c?{x:parseFloat(c[0]),y:parseFloat(c[1]),z:parseFloat(c[2]),th:parseFloat(c[3])}:"club"==g[0].type?{x:4,y:0,z:0==b?-1:1,th:Math.PI/2+(0==b?.5:-.7)}:"ring"==g[0].type?{x:0,y:1,z:0,th:Math.PI/2}:{x:1,y:0,z:0,th:0},{x:parseFloat(d[0])/100,y:d[1]?parseFloat(d[1])/100:0,z:d[2]?parseFloat(d[2])/100:0,rotation:f}}))}for(var m=b[4].split(" "),n=1==m[0]?!0:!1,o=parseFloat(m[1]),p=parseFloat(m[2]),q=parseFloat(m[3]),r=parseFloat(m[4]),s=parseFloat(m[5]),t=b[5].split(" "),u=void 0,h=0;h<t.length;h+=3)void 0===u&&(u=[]),u.push({position:{x:parseFloat(t[h]),z:parseFloat(t[h+1])},rotation:parseFloat(t[h+2])});for(var v=[],h=6;h<b.length;h++){var w=b[h].split(" ");v.push({position:{x:parseFloat(w[0]),y:parseFloat(w[1]),z:parseFloat(w[2])},normal:{x:parseFloat(w[3]),y:parseFloat(w[4]),z:parseFloat(w[5])},scale:parseFloat(w[6])})}return{siteswap:c,beatDuration:d,dwellRatio:e,props:g,inputDwellPath:i,dwellPath:k,matchVelocity:n,dwellCatchScale:o,dwellTossScale:p,emptyTossScale:q,emptyCatchScale:r,armAngle:s,surfaces:v,jugglers:u}}function g(){E||b("animator");var a=f($("#inputsAdvanced").val()),c=window.location.href.replace("#","");c.indexOf("?")>-1&&(c=c.substring(0,c.indexOf("?")));var d="?v=16&siteswap="+encodeURIComponent(a.siteswap)+"&beatDuration="+a.beatDuration+"&dwellPath="+a.inputDwellPath;if($("#saveURL").text(c+d),$("#saveURL").attr("href",c+d),window.siteswap=A.CreateSiteswap(a.siteswap,{beatDuration:a.beatDuration,dwellRatio:a.dwellRatio,props:a.props,dwellPath:a.dwellPath,matchVelocity:a.matchVelocity,dwellCatchScale:a.dwellCatchScale,dwellTossScale:a.dwellTossScale,emptyTossScale:a.emptyTossScale,emptyCatchScale:a.emptyCatchScale,armAngle:a.armAngle,surfaces:a.surfaces,jugglers:a.jugglers}),siteswap.errorMessage)animator.paused=!0,$("#errorMessage").show(),$("#message").text(siteswap.errorMessage);else{siteswap.collision?($("#errorMessage").show(),$("#message").text("This pattern has collisions.")):$("#errorMessage").hide();var e=!1;"ball"==siteswap.props[0].type&&1==siteswap.numJugglers&&(e=!0),animator.init(siteswap,{drawHands:$("#drawHands")[0].checked}),animator.animate()}}function h(){animator.zoomIn()}function i(){animator.zoomOut()}function j(){var a=parseFloat($("#animationSpeed").val());animator.updateAnimationSpeed(a)}function k(){var a=$("#cameraMode").val();if(cameraMode={mode:a},"custom"==a){var b=$("#cameraCustomPosition").val().split(",");cameraMode.x=parseFloat(b[0]),cameraMode.y=parseFloat(b[1]),cameraMode.z=parseFloat(b[2])}animator.updateCameraMode(cameraMode)}function l(){animator.displayPropPaths=!animator.displayPropPaths,animator.displayPropPaths?animator.showPropPaths():animator.hidePropPaths()}function m(){var a=f($("#inputsAdvanced").val());$("#lblSiteswap").text(a.siteswap),$("#lblBeatDuration").text(a.beatDuration),$("#lblDwellRatio").text(a.dwellRatio);for(var b="",c=0;c<a.props.length;c++){var d=a.props[c];b+=d.color+" "+d.type+" "+d.radius+"m "+d.C,c<a.props.length-1&&(b+=", ")}$("#lblProps").text(b),$("#lblDwellPath").text(a.inputDwellPath),$("#lblMatchVelocity").text(1==a.matchVelocity?"Y":"N"),$("#lblDwellCatchScale").text(a.dwellCatchScale),$("#lblDwellTossScale").text(a.dwellTossScale),$("#lblEmptyTossScale").text(a.emptyTossScale),$("#lblEmptyCatchScale").text(a.emptyCatchScale),$("#lblArmAngle").text(a.armAngle+" rad");for(var e="",c=0;c<a.surfaces.length;c++){var g=a.surfaces[c];e+="surface "+c+": position <"+g.position.x+","+g.position.y+","+g.position.z+"> normal <"+g.normal.x+","+g.normal.y+","+g.normal.z+"> half-width "+g.scale+"m",c<a.surfaces.length-1&&(e+=", ")}$("#lblSurfaces").text(e)}function n(a){$.getJSON("examples.json",function(b){for(var c=0;c<b.examples.length;c++)b.examples[c].name==a&&(e(d(b.examples[c])),g())})}function o(){$.getJSON("examples.json",function(a){for(var b=0;b<a.examples.length;b++)$("#examplesList").append('<li><a href="#" onclick="runExample(\''+a.examples[b].name+"');\">"+a.examples[b].name+"</a></li>")})}function p(){$("#gifProgress").show(),$("#gifLink").empty(),animator.paused=!0;var a=Math.round(siteswap.states.length*siteswap.beatDuration*35),b=0,c=document.createElement("canvas");c.width=animator.renderer.domElement.width,c.height=animator.renderer.domElement.height;var d=c.getContext("2d"),e=new Uint8Array(c.width*c.height*a*5),f=new GifWriter(e,c.width,c.height,{loop:0}),g=new Uint8Array(c.width*c.height),h=function(){animator.render(b/a*siteswap.states.length*siteswap.beatDuration*1e3),d.drawImage(animator.renderer.domElement,0,0);for(var e=d.getImageData(0,0,c.width,c.height).data,j=[],k=0,l=0,m=e.length;m>k;k+=4,l++){var n=10*Math.floor(.1*e[k+0]),o=10*Math.floor(.1*e[k+1]),p=10*Math.floor(.1*e[k+2]),q=n<<16|o<<8|p<<0,r=j.indexOf(q);-1===r?(g[l]=j.length,j.push(q)):g[l]=r}for(var s=1;s<j.length;)s<<=1;j.length=s,f.addFrame(0,0,c.width,c.height,g,{palette:new Uint32Array(j),delay:5}),$("#gifProgress").val(b/a),b++,b==a?i():setTimeout(h,0)},i=function(){for(var a="",b=0,c=f.end();c>b;b++)a+=String.fromCharCode(e[b]);$("#gifLink").append("<a href='data:image/gif;base64,"+btoa(a)+"' target='_blank'>Download GIF</a>"),animator.paused=!1,animator.animate(),$("#gifProgress").hide()};h()}function q(){window.onresize(),$("#siteswapsList").empty(),$("#graphContainer").empty(),$("#activeSiteswapContainer").hide();var a=($("#exclude").val(),{minPeriod:1,maxPeriod:parseInt($("#explorerMaxPeriod").val()),numProps:parseInt($("#explorerNumProps").val()),maxSiteswaps:parseInt($("#explorerMaxSiteswaps").val()),includeExcited:$("#explorerIncludeExcited")[0].checked,includeMultiplex:$("#explorerIncludeMultiplex")[0].checked,async:!0,sync:$("#explorerSync")[0].checked,callbacks:{siteswapFound:function(a,b,c){$("#siteswapsList").append('<li><a class="'+(c?"excited":"ground")+'" href="#" onclick="runSiteswap(\''+a+"')\">"+a+"</a></li>")}}});C.siteswapGraph(a)}function r(a){$("#siteswap").val(a),c(),g()}function s(){"ball"!=$("#prop").val()&&($("#drawHands")[0].checked=!1)}function t(){"custom"==$("#cameraMode").val()?$("#cameraCustomPositionContainer").show():$("#cameraCustomPositionContainer").hide()}function u(){var a={},b=D.getURLQueryStringParameterByName("siteswap"),c=JSON.parse(D.getURLQueryStringParameterByName("props")),d=D.getURLQueryStringParameterByName("beatDuration"),e=D.getURLQueryStringParameterByName("dwellPath");return null!==b&&(a.siteswap=b),null!==c&&(a.props=c),null!==d&&(a.beatDuration=d),null!==e&&(a.dwellPath=e),a}function v(){var a=w();a.push({name:$("#savedName").val(),version:16,inputs:$("#inputsAdvanced").val()}),window.localStorage.setItem("savedSiteswaps",JSON.stringify(a)),x(),$("#saveSuccess").show(1e3),setTimeout(function(){$("#saveSuccess").hide(1e3)},2e3)}function w(){return null===window.localStorage.getItem("savedSiteswaps")&&window.localStorage.setItem("savedSiteswaps","[]"),JSON.parse(window.localStorage.getItem("savedSiteswaps"))}function x(){var a=w(),b=$("#savedList");b.empty();for(var c=0;c<a.length;c++)b.append('<li><a href="#" class="deleteLink" onclick="deleteSavedSiteswap('+c+');"><span class="glyphicon glyphicon-remove"></span></a><a href="#" onclick="runSavedSiteswap('+c+');">'+a[c].name+"</a></li>")}function y(a){var b=w();$("#inputsAdvanced").val(b[a].inputs),g()}function z(a){var b=w();b.splice(a),window.localStorage.setItem("savedSiteswaps",JSON.stringify(b)),x()}var A=a("./Siteswap.js"),B=a("./SiteswapAnimator.js"),C=a("./SiteswapGraph.js"),D=a("./util.js"),E=!1;window.onload=function(){b("pattern"),c(),window.animator=new B.SiteswapAnimator("animatorCanvasContainer",{displayPropPaths:!1}),window.onresize(),o(),x(),e(d(u())),g()},window.onresize=function(){var a=$(window).width()-5,b=$(window).height()-10,c=500,d=a-c,e=250,f=b;d>e?($("#nav #animator").hide(),$("#animatorCanvasContainer").appendTo($("body")),$("#animatorMenu").removeClass("controlDiv"),E=!0):(c>a&&(c=a),$("#nav #animator").show(),$("#animatorCanvasContainer").appendTo($("#controlsContainer #animatorMenu")),$("#animatorMenu").addClass("controlDiv"),d=a,c=a,E=!1,f=b-$("#animatorCanvasContainer").offset().top),$("#controlsContainer").height(b),$("#controlsContainer").width(c),$("#animatorCanvasContainer").height(f),$("#animatorCanvasContainer").width(d),$("#generatedSiteswaps").height(b-$("#generatedSiteswaps").offset().top),$("#exampleSiteswaps").height(b-$("#exampleSiteswaps").offset().top),$("#savedSiteswaps").height(b-$("#exampleSiteswaps").offset().top),$("#patternMenu").height(b-$("#patternMenu").offset().top),animator.resize&&animator.resize(d,b)},window.go=g,window.displayMenu=b,window.updateAdvancedInputsFromBasic=c,window.zoomIn=h,window.zoomOut=i,window.updateAnimationSpeed=j,window.updateCameraMode=k,window.updateDisplayPropPaths=l,window.updateAdvancedLabels=m,window.runExample=n,window.generateGIF=p,window.findSiteswaps=q,window.runSiteswap=r,window.updateDrawHandsForProp=s,window.showHideCameraCustomPosition=t,window.saveCurrentSiteswap=v,window.runSavedSiteswap=y,window.deleteSavedSiteswap=z},{"./Siteswap.js":3,"./SiteswapAnimator.js":4,"./SiteswapGraph.js":5,"./util.js":7}],7:[function(a,b){b.exports.getURLQueryStringParameterByName=function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?null:decodeURIComponent(c[1].replace(/\+/g," "))},b.exports.cloneObject=function(a){var c=a instanceof Array?[]:{};for(var d in a)"clone"!=d&&(c[d]=a[d]&&"object"==typeof a[d]?b.exports.cloneObject(a[d]):a[d]);return c},b.exports.arraysEqual=function(a,c){if(!(a instanceof Array&&c instanceof Array))return!1;if(a.length!=c.length)return!1;for(var d=0;d<a.length;d++)if(a[d]instanceof Array||c[d]instanceof Array){var e=b.exports.arraysEqual(a[d],c[d]);if(!e)return!1}else if(a[d]!=c[d])return!1;return!0},Array.prototype.last||(Array.prototype.last=function(){return this[this.length-1]}),b.exports.cross=function(a,b){return{x:a.y*b.z-a.z*b.y,y:a.z*b.x-a.x*b.z,z:a.x*b.y-a.y*b.x}},b.exports.dot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z},b.exports.magnitude=function(a){return Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z)},b.exports.normalize=function(a){var c=b.exports.magnitude(a);return a.x=a.x/c,a.y=a.y/c,a.z=a.z/c,a},b.exports.multiply=function(a,b){return a.x*=b,a.y*=b,a.z*=b,a},b.exports.add=function(a,b){return a.x+=b.x,a.y+=b.y,a.z+=b.z,a},b.exports.sub=function(a,b){return a.x-=b.x,a.y-=b.y,a.z-=b.z,a},b.exports.negate=function(a){return b.exports.multiply(a,-1),a}},{}]},{},[6]);